<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>作品清單｜voxhuma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <style>
    :root { --max-w: 1120px; --fg: #0d0d0d; --muted: #666; --bg: #ffffff; --brand: #111827; --accent: #111827; --radius: 14px; }
    *{ box-sizing:border-box }
    html, body { margin:0; padding:0; font-family: 'Noto Sans TC', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color: var(--fg); background: var(--bg); }
    a { color: inherit; text-decoration: none }
    img { max-width: 100%; display:block; height:auto }
    .container { max-width: var(--max-w); margin: 0 auto; padding: 0 20px; }
    header { position: sticky; top:0; z-index:10; backdrop-filter: saturate(180%) blur(10px); background: rgba(255,255,255,.85); border-bottom:1px solid #eee; }
    .nav { display:flex; align-items:center; justify-content:space-between; height:64px; }
    .logo { display:flex; align-items:center; gap:10px; font-weight:800 }
    .logo img { height:40px; width:auto; max-height:40px; max-width:none; object-fit:contain; border-radius:6px }
    .searchbar { display:flex; gap:10px; flex-wrap:wrap }
    .searchbar input, .searchbar select { padding:10px 12px; border:1px solid #ddd; border-radius:10px }
    .searchbar button { padding:10px 14px; border-radius:10px; background:var(--brand); color:#fff; font-weight:700; border:0 }
    main { padding: 28px 0 60px }
    h1 { margin: 8px 0 18px; font-size: clamp(24px, 4vw, 36px); }
    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap:20px }
    .card { grid-column: span 12; border:1px solid #eee; border-radius: var(--radius); overflow:hidden; background:#fff; display:flex; flex-direction:column }
    .thumb { aspect-ratio: 16/9; background:#f6f6f6; display:flex; align-items:center; justify-content:center; font-size:12px; color:#999 }
    .meta { padding:14px; display:flex; flex-direction:column; gap:6px }
    .title { font-weight:700 }
    .muted { color:var(--muted); font-size:14px }
    .row { display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap }
    .tags { display:flex; gap:8px; flex-wrap:wrap }
    .tag { font-size:12px; padding:4px 8px; border-radius:999px; background:#f3f4f6; border:1px solid #eee }
    .empty { padding:40px; text-align:center; color:#777 }
    .pager { display:flex; justify-content:center; gap:10px; margin-top:24px }
    .pager button { padding:8px 12px; border:1px solid #ddd; background:#fff; border-radius:10px }
    @media (min-width: 900px){ .card{ grid-column: span 4 } }
  </style>
<style id="cols-override">
  #list.grid { grid-template-columns: repeat(12, 1fr) !important; }
  #list.grid > .card { grid-column: span 12 !important; }
  @media (min-width: 480px){  #list.grid > .card { grid-column: span 6 !important; } }   /* 2 columns */
  @media (min-width: 768px){  #list.grid > .card { grid-column: span 4 !important; } }   /* 3 columns */
  @media (min-width: 1024px){ #list.grid > .card { grid-column: span 3 !important; } }   /* 4 columns */
</style>
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
  <header>
    <div class="container nav">
      <a class="logo" href="./">
        <img src="logo.png" alt="voxhuma">
        <span>voxhuma</span>
      </a>
      <form id="filters" class="searchbar" onsubmit="event.preventDefault(); load()">
        <input id="q" type="search" placeholder="搜尋標題或標籤…" />
        <select id="sort">
          <option value="date_desc">最新優先</option>
          <option value="date_asc">最舊優先</option>
          <option value="title_asc">標題 A→Z</option>
          <option value="title_desc">標題 Z→A</option>
        </select>
        <button type="submit">套用</button>
      </form>
    </div>
  </header>

  <main class="container">
    <h1>作品清單</h1> <span id="count" class="muted"></span>
<div class="toolbar">  <button id="viewCard" class="viewbtn" aria-pressed="true">卡片模式</button>
  <button id="viewThumbs" class="viewbtn" aria-pressed="false">縮圖網格模式</button>
</div> <span id="count" class="muted"></span>
    <div id="list" class="grid" aria-live="polite"></div>
    <div id="pager" class="pager" hidden>
      <button id="prev">上一頁</button>
      <span id="pageInfo" class="muted"></span>
      <button id="next">下一頁</button>
    </div>
    <div id="empty" class="empty" hidden>目前尚無作品</div>
  </main>

  <template id="card-tpl">
    <article class="card">
      <a class="thumb" target="_blank" rel="noopener" aria-label="開啟作品"></a>
      <div class="meta">
        <div class="row">
          <a class="title" target="_blank" rel="noopener"></a>
          <span class="muted date"></span>
        </div>
        <div class="tags"></div>
      </div>
    </article>
  </template>

  <script>(function(){
  const state = { items: [], page: 1, pageSize: 24, view: localStorage.getItem('view') || 'card', total: 0 };
  const $ = (id)=>document.getElementById(id);
  function dateOnly(v){ const d=v?new Date(v):new Date(); return d.toLocaleDateString('zh-TW'); }
  function share(url,title){
    try{
      if (navigator.share) return navigator.share({title, url});
      if (navigator.clipboard && navigator.clipboard.writeText){ navigator.clipboard.writeText(url); alert('已複製分享連結'); return; }
      prompt('複製此連結：', url);
    }catch(_){}
  }
  function applyView(){
    const grid=$('list'); if(!grid) return;
    grid.classList.toggle('thumbs', state.view==='thumbs');
    $('viewCard')&&$('viewCard').setAttribute('aria-pressed', String(state.view==='card'));
    $('viewThumbs')&&$('viewThumbs').setAttribute('aria-pressed', String(state.view==='thumbs'));
    localStorage.setItem('view', state.view);
  }
  function pageSlice(items){
    if (state.pageSize>=99999) return items;
    const start=(state.page-1)*state.pageSize, end=start+state.pageSize;
    return items.slice(start,end);
  }
  function render(){
    const grid=$('list'); if(!grid) return; grid.innerHTML='';
    const pageItems=pageSlice(state.items);
    for (let i=0;i<pageItems.length;i++){
      const it=pageItems[i];
      const card=document.createElement('article'); card.className='card';
      const a=document.createElement('a'); a.href=`post.html?slug=${encodeURIComponent(it.slug||it.id||'')}`;
      const img=document.createElement('img'); img.className='thumb'; img.alt=it.title||'';
      img.src=(it.cover||it.thumbnail||it.image||(it.images&&it.images[0])||'').toString();
      a.appendChild(img); card.appendChild(a);
      const meta=document.createElement('div'); meta.className='meta';
      meta.innerHTML=`<div class="title">${it.title||'(未命名)'}</div>
                      <div class="date"></div>
                      <div class="tags"></div>
                      <div class="actions"></div>`;
      const dateEl=meta.querySelector('.date');
      if(dateEl){ const dsrc=it.date||it.created_at||it.updated_at||''; dateEl.textContent=dateOnly(dsrc); }
      const tagsWrap=meta.querySelector('.tags');
      const tags=Array.isArray(it.tags)?it.tags:(it.tags?String(it.tags).split(/[, \s]+/).map(s=>s.trim()).filter(Boolean):[]);
      for(const t of tags){ const span=document.createElement('span'); span.className='tag'; span.textContent=t; tagsWrap&&tagsWrap.appendChild(span); }
      const actions=meta.querySelector('.actions');
      const shareBtn=document.createElement('button'); shareBtn.className='viewbtn'; shareBtn.type='button'; shareBtn.textContent='分享';
      shareBtn.addEventListener('click',(e)=>{ e.preventDefault(); const url=new URL('post.html', location.href); url.searchParams.set('slug', it.slug||it.id||''); share(url.toString(), it.title||document.title); });
      actions&&actions.appendChild(shareBtn);
      card.appendChild(meta); grid.appendChild(card);
    }
    if($('count')) $('count').textContent=`共 ${state.total} 筆作品`;
    const pages = state.pageSize>=99999 ? 1 : Math.max(1, Math.ceil(state.total/state.pageSize));
    const info=$('pageinfo'); if(info) info.textContent = state.pageSize>=99999 ? '顯示全部' : `${state.page} / ${pages}`;
    if($('prev')) $('prev').disabled = state.page<=1 || state.pageSize>=99999;
    if($('first')) $('first').disabled = state.page<=1 || state.pageSize>=99999;
    if($('next')) $('next').disabled = state.page>=pages || state.pageSize>=99999;
    if($('last')) $('last').disabled = state.page>=pages || state.pageSize>=99999;
    if($('restorePaging')) $('restorePaging').style.display = state.pageSize>=99999 ? 'inline-flex' : 'none';
    applyView();
  }
  async function fetchList(){
    const res = await fetch('/.netlify/functions/list-posts');
    if(!res.ok) throw new Error('清單載入失敗');
    const data = await res.json();
    const items = Array.isArray(data.items)?data.items:[];
    state.items = items; state.total = items.length;
  }
  function wire(){
    $('viewCard')&&$('viewCard').addEventListener('click', ()=>{ state.view='card'; render(); });
    $('viewThumbs')&&$('viewThumbs').addEventListener('click', ()=>{ state.view='thumbs'; render(); });
    $('prev')&&$('prev').addEventListener('click', ()=>{ if(state.page>1){ state.page--; render(); } });
    $('next')&&$('next').addEventListener('click', ()=>{ const pages=Math.max(1, Math.ceil(state.total/state.pageSize)); if(state.page<pages){ state.page++; render(); } });
    $('first')&&$('first').addEventListener('click', ()=>{ state.page=1; render(); });
    $('last')&&$('last').addEventListener('click', ()=>{ const pages=Math.max(1, Math.ceil(state.total/state.pageSize)); state.page=pages; render(); });
    $('showAll')&&$('showAll').addEventListener('click', ()=>{ state.page=1; state.pageSize=99999; render(); });
    $('restorePaging')&&$('restorePaging').addEventListener('click', ()=>{ state.pageSize=24; state.page=1; render(); });
  }
  (async function init(){ try{ wire(); applyView(); await fetchList(); render(); }catch(e){ console.warn(e); } })();
})();</script>
</body>
</html>
